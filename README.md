# Using GitHub Actions to Test & Deploy to RStudio Connect

RStudio Connect hosts a variety of data artifacts with different development 
life cycles. Whenever you want to publish one of these data artifacts to RStudio 
Connect, there are three paths you can follow:

 - Push-button deployment process within the RStudio IDE
 - Git-backed deployment within RStudio Connect
 - Programmatic deployment

This repository is an example of the third deployment path using GitHub Actions as
a CI/CD pipeline to test and deploy a Shiny application to RStudio Connect. 

If you want to learn more about it you can read: [https://solutions.rstudio.com/data-science-admin/deploy/ci-cd/github-actions/](https://solutions.rstudio.com/data-science-admin/deploy/ci-cd/github-actions/)

## Usage

Setup the `venv` environment:

```bash
python -m venv .venv
. .venv/bin/activate
# .venv\Scripts\activate # Windows
```

Upgrade pip and then install needed packages:

```bash
pip install --upgrade pip
python -m pip install --upgrade pip wheel setuptools rsconnect-python
pip install -r requirements.txt
```

Run the application:

```bash
shiny run --reload app.py
```

Or run the app with Python: 

```bash
python app.py
```

Leave a virtual environment with:

```bash
deactivate
```

## Deploy

### rsconnect-python CLI

```bash
rsconnect deploy shiny .
```

### Git-backed

Update the code, and then run:

```bash
rsconnect write-manifest shiny --overwrite .
```

Commit the new `manifest.json` file to the git repo along with the code.

## Updates

Create the requirements file:

```bash
python -m pip freeze > requirements.txt
```

```bash
rsconnect write-manifest shiny .
```

If you are running into deploy issues where there are breaking packages you can edit the requirements file explicitly: 

```bash
# requirements.txt generated by rsconnect-python on 2022-09-21 14:59:58.865441
streamlit==1.11.0
```

To use a Package Manager repository with a specific project defined by a `requirements.txt` file, add `-i [repositoryURL]` to the top of your file, for example:

```bash
-i https://packagemanager.posit.co/pypi/latest/simple
pandas
scipy
```

How to configure a pypi repository globally (using pip.conf): 
<https://docs.posit.co/resources/install-python/#optional-configure-a-pypi-repository>

## Troubleshooting

### Issues with Python not being on path

Set it manually to an installed Python version with: 

```bash
alias python="/opt/python/3.9.17/bin/python"
```

Set it in your .bashrc on mac or linux so that it is set for your profile every time you log in (typically this is located in the root directory of your home folder): 

```bash
# add this to your .bashrc
export PATH=/opt/python/3.11.9/bin:$PATH
```

Check for the available python versions (if typically installed): 

```bash
ls -ld /opt/python/*
```

## Resources

[Posit Connect User Guide: Shiny for Python](https://docs.posit.co/connect/user/shiny-python/)
